var isRunning=!1,SCRIPTNAME="OpenrecChatOnScreen",COLER="#ffffff",OCOLER="#000000",OWIDTH=.1,LINEHEIGHT=.75,DURATION=5,FPS=60,opacity=.5,maxLines=14,url=location.href,site=-1!=url.indexOf("live")?{getScreen:function(){return document.querySelector(".video-player-wrapper")},getBoard:function(){return document.querySelector(".chat-list-content")},getComments:function(a){return a.querySelector(".chat-content")},getPlay:function(){return document.querySelector('[class^="MovieToolbar"] [class^="TextLabel__Wrapper"]')}}:
{getScreen:function(){return document.querySelector('[class^="Component__PlayerWrapper"]')},getBoard:function(){return document.querySelector('[class^="ChatList__Content"]')},getComments:function(a){return a.querySelector(".chat-content")},getPlay:function(){return document.querySelector('[class^="ControlBar__Wrapper"]')}},display,board,play,canvas,context,lines=[],fontsize,core={init:function(){display=site.getScreen();board=site.getBoard();play=site.getPlay();display&&board&&play?(canvas=document.createElement("canvas"),
canvas.id=SCRIPTNAME,display.appendChild(canvas),context=canvas.getContext("2d"),core.addStyle(),core.listenComments(),core.scrollComments()):window.setTimeout(function(){return core.init()},1E3)},addStyle:function(){var a=document.getElementsByTagName("head")[0];if(a){var b=document.createElement("style");b.setAttribute("type","text/css");b.innerHTML="canvas#"+SCRIPTNAME+"{ pointer-events: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: "+opacity+"; z-index: 10000;}";
a.appendChild(b)}},listenComments:function(){board&&board.addEventListener("DOMNodeInserted",function(a){if(a=site.getComments(a.target))core.modify(),core.attachComment(a)})},modify:function(a){void 0===a&&(a=!1);display&&context&&(canvas.width!=display.offsetWidth||a)&&(canvas.width=display.offsetWidth,canvas.height=display.offsetHeight,fontsize=canvas.height/maxLines*LINEHEIGHT,context.font="bold "+fontsize+"px sans-serif",context.fillStyle=COLER,context.strokeStyle=OCOLER,context.lineWidth=fontsize*
OWIDTH)},attachComment:function(a){if(isRunning&&context&&(a=a.textContent)){var b=context.measureText(a).width,c=DURATION*FPS,d=(canvas.width+b)/c;a={text:a,width:b,life:c,left:canvas.width,speed:d,reveal:b/d,touch:b/d,top:0};for(b=0;b<maxLines;b++){c=lines[b]?lines[b].length:0;if(!lines[b]||!c)lines[b]=[];else if(!(lines[b][c-1].speed>a.speed&&0>lines[b][c-1].reveal||lines[b][c-1].speed<a.speed&&lines[b][c-1].life<a.touch))continue;a.top=canvas.height/maxLines*b+fontsize;lines[b].push(a);break}}},
scrollComments:function(){window.setInterval(function(){if(site.getPlay()&&context){context.clearRect(0,0,canvas.width,canvas.height);for(var a=0;lines[a];a++){for(var b=0;lines[a][b];b++)context.strokeText(lines[a][b].text,lines[a][b].left,lines[a][b].top),context.fillText(lines[a][b].text,lines[a][b].left,lines[a][b].top),lines[a][b].life--,lines[a][b].reveal--,lines[a][b].touch--,lines[a][b].left-=lines[a][b].speed;lines[a][0]&&0==lines[a][0].life&&lines[a].shift()}}},1E3/FPS)},setOpacity:function(){var a=
document.getElementById(SCRIPTNAME);a&&(a.style.opacity=opacity.toString())}};core.init();chrome.storage.local.get({isRunning:!1},function(a){isRunning=a.isRunning});chrome.storage.local.get({numOfLines:14},function(a){maxLines=a.numOfLines});chrome.storage.local.get({opacity:50},function(a){opacity=.01*a.opacity;core.setOpacity()});
chrome.runtime.onMessage.addListener(function(a,b,c){"switchOnOff"===a.message?isRunning=!isRunning:"changeNumOfLines"===a.message?(maxLines=a.numOfLines,core.modify(!0)):"changeOpacity"===a.message&&(opacity=.01*a.opacity,core.setOpacity())});